/* ****************************
** Copyright (c) 2015        **
** Riverbed Technology, Inc. **
** All Rights Reserved.      **
** ************************* */

"use strict";

// *****************************
// Output Process Module
// *****************************

// required modules
var outputToFile = require('./trace-output-file');
// first arg is directory to output results either current working directory or resultsDir if specified
// second arg is id for identifying results
outputToFile.init(process.argv[2],process.argv[3]);

process.on("message",function(m){
	if(m.trace) {
		outputToFile.addTraceResult(m.trace);
	} else if(m.env) {
		outputToFile.addEnvResult(m.env);
	} else{
		require('./trace-output-api').info('trace-output-process-file','ignoring unknown message type: '+m);
	}
});

// listen for this to be disconnected from the parent.
// when that happens, terminate the child process.
process.on("disconnect",function(){
	if(outputToFile) {
		outputToFile.shutdown();
	}
	process.exit();
});